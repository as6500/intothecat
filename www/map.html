<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .mapTile {
            display: inline;
        }
        .centered-text {
            text-align: center;
        }
        .legendas {
            height: 250px;
            text-align: center;
        }
        #tilenumbers {
            text-align: center;
            margin-top: -350px; /* Adjust as needed to create space between map and image */
            size-adjust: 50%;
        }
        </style>
    <script>
        function getPlayerPawns() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                // readyState == 4 means is done (enum). status == 200 - estado http tudo OK
            if (this.readyState == 4 && this.status == 200) {
                response = JSON.parse(xhttp.responseText);
                console.log(response);

                for (var i = 0; i < response.player1Rows.length; i++) {
                    var tileID = "tile" + response.player1Rows[i].tile_location_board_id
                    if (response.player1Rows[i].pawn_name == "Mind-cat"){
                        document.getElementById(tileID).innerHTML = "ðŸ˜¹";
                    }
                    if (response.player1Rows[i].pawn_name == "Machine-cat"){
                        document.getElementById(tileID).innerHTML = "ðŸš“";
                    }
                }

                for (var i = 0; i < response.player2Rows.length; i++) {
                    var tileID = "tile" + response.player2Rows[i].tile_location_board_id
                    if (response.player2Rows[i].pawn_name == "Mind-cat"){
                        document.getElementById(tileID).innerHTML = "ðŸ˜»";
                    }
                    if (response.player2Rows[i].pawn_name == "Machine-cat"){
                        document.getElementById(tileID).innerHTML = "ðŸš—";
                    }
                }
            }};
            //fux this to make it dynamic
            xhttp.open("GET", "/map/match/"+ 2 + "/", true);
            xhttp.send();
        }

        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                response = JSON.parse(xhttp.responseText);
                console.log(response);
                var newMapPrint = "";
                var lastY = 1;

                //this for loop logs every single tile
                for (var i = 0; i < response.length; i++) {

                    var currentX = response[i].tile_x_coordinates;
                    var currentY = response[i].tile_y_coordinates;

                    if (lastY !== currentY){
                        lastY = currentY;
                        newMapPrint += "</br>";
                    }

                    var tileType = response[i].tiletype.split(" "); // Se alguma vez aparecer um tile com um espaÃ§o vai partir isto tudo :(
                    var tileTypeKey = tileType[1];
                    var tileTypeKey = tileTypeKey.replace("(", "");
                    var tileTypeKey = tileTypeKey.replace(")", "");

                    if (tileTypeKey == 3)
                        tileTypeKey = "â¬›";
                    else if (tileTypeKey == 2)
                        tileTypeKey = "ðŸŸ¦";
                    else if (tileTypeKey == 1)
                        tileTypeKey = "â¬œ";

                    // mapPrint += tileTypeKey;
                    newMapPrint += "<div id='tile" + (i+1) + "' class='mapTile'>" + tileTypeKey + "</div>"
                }

                document.getElementById("newMap").innerHTML = newMapPrint;
                getPlayerPawns();
            }
        };
        
        xhttp.open("GET", "/map/1", true);
        xhttp.send();
    </script>
</head>
<body style="background-color:#f395ff;">
    <div style="text-align: center" id="newMap"></div>
    <div id="tilenumbers">
        <img src="tilenumbers.png" alt="Tile Numbers">
    </div>
    <div class="legendas">â¬›:wall tile<br> â¬œ:ground tile<br> ðŸŸ¦:water tile<br> ðŸ˜¹:p1 mind-cat<br> ðŸš“:p1 machine-cat<br> ðŸ˜»:p2 mind-cat <br> ðŸš—:p2 machine-cat</div>
</body>
</html>